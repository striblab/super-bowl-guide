<div class="component component-item">
  <article class="item item-{{ display }} {{ data.inView ? 'in-view' : '' }}" data-id="{{ data.id }}">
    <div class="item-header">
      <div class="item-header-left">
        <h1 class="heading-alternate">
          <a href="{{ data.basePath }}/{{ data.filename }}">{{ data.name }}</a>
        </h1>

        {{#if byline && display !== 'list'}}
          <div class="byline">{{{ byline }}}</div>
        {{/if}}

        {{#if data.address}}
          <address>{{ data.address }}</address>
        {{/if}}
      </div>

      <div class="item-header-right">
        <div class="near-me">
          {{#if data.distance && view === 'distance'}}
            {{ utils.round(data.distance, 1) }} mi
          {{else}}
            &nbsp;
          {{/if}}
        </div>

        {{#if data.latitude && data.longitude}}
          <a href="{{ directionsURL }}" target="_blank" rel="noopener" class="directions">Directions</a>
        {{/if}}
      </div>
    </div>

    {{#if data.mainImage && data.mainImage[0] && display !== 'map' }}
      <div class="item-image">
        <figure>
          <picture>
            <source
              type="image/webp"
              srcset="{{ srcset(data, 'mainImageLocal', 'webp') }}"
              sizes="100vw">
            <source
              type="image/jpeg"
              srcset="{{ srcset(data) }}"
              sizes="100vw">
            <img
              alt="Main image for '{{ data.name }}'"
              src="{{ data.basePath }}/{{ data.mainImageLocal }}">
          </picture>

          <cite>{{ data.imageCredit}}</cite>
        </figure>
      </div>
    {{/if}}

    <p>{{{ data.description }}}</p>

    {{#if display !== 'map'}}
      {{#if data.phone || data.website || data.startDate}}
        <dl>
          {{#if data.startDate}}
            <dt><span>When</span></dt>
            <dd><span>
              {{ data.startDate }}
              {{ data.endDate && data.startDate !== data.endDate ? ' - ' + data.endDate : '' }}
            </span></dd>
          {{/if}}

          {{#if data.phone}}
            <dt><span>Phone</span></dt>
            <dd><span class="linkable">{{ data.phone }}</span></dd>
          {{/if}}

          {{#if data.website}}
            <dt><span>Website</span></dt>
            <dd><span class="linkable">
              <a href="{{ data.website }}<" target="_blank" rel="noopener">{{ data.website }}</a>
            </span></dd>
          {{/if}}
        </dl>
      {{/if}}

      <div class="social-buttons social-buttons-gray">
        <a href="{{ facebookURL }}" target="_blank" rel="noopener" class="facebook-button">
          <span class="sr-only">Share on Facebook</span>
        </a>
        <a href="{{ twitterURL }}" target="_blank" rel="noopener" class="twitter-button">
          <span class="sr-only">Share on Twitter</span>
        </a>
        <a href="{{ emailURL }}" target="_blank" rel="noopener" class="email-button">
          <span class="sr-only">Share via email</span>
        </a>
      </div>

      {{#if display !== 'list' && data.lists}}
        <div class="related">
          <h3>Related</h3>
          {{#each data.lists as l @id}}
            <a href="{{ data.basePath }}/{{ l.filename }}">{{ l.title }}</a>
          {{/each}}
        </div>
      {{/if}}
    {{/if}}
  </article>
</div>

<script>
export default {
  data() {
    return {
      display: 'full',
      isBrowser: typeof window !== undefined
    };
  },

  computed: {
    byline: function(data) {
      return !data || !data.byline
        ? ''
        : ~data.byline.indexOf('•')
          ? data.byline
          : `<strong>By ${data.byline}</strong> • Star Tribune`;
    },

    directionsURL: function(data, store) {
      let location =
        store && store.location && store.location.position
          ? store.location.position.lat + ',' + store.location.position.lng
          : undefined;
      return `https://www.google.com/maps/dir/?api=1${encodeURIComponent(
        location ? '&origin=' + location : ''
      )}&destination=${encodeURIComponent(data.latitude)},${encodeURIComponent(
        data.longitude
      )}`;
    },

    facebookURL: function(data, content) {
      return `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(
        data.baseURL + data.filename
      )}`;
    },

    twitterURL: function(data, content) {
      return `https://twitter.com/intent/tweet?text=${encodeURIComponent(
        data.twitterShare || (content ? content.twitterShare : '')
      )}&url=${encodeURIComponent(
        data.baseURL + data.filename
      )}&via=${encodeURIComponent(content.twitterAccount)}`;
    },

    emailURL: function(data, content) {
      return `mailto:RECIPIENT?subject=${encodeURIComponent(
        data.emailShare || (content ? content.emailShare : '')
      )}&body=${encodeURIComponent(data.baseURL + data.filename)}`;
    }
  },

  helpers: {
    srcset: function(data, prop = 'mainImageLocal', extension) {
      let p = data.basePath + '/' + data[prop];

      return ['300', '600', '900', '1200', '2000']
        .map(w => {
          return (
            p
              .replace(/\.([a-z]+$)/i, '-' + w + 'px.$1')
              .replace(/\.([a-z]+$)/i, extension ? '.' + extension : '.$1') +
            ' ' +
            w +
            'w'
          );
        })
        .join(', ');
    }
  }
};
</script>
